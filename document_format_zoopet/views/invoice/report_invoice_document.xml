<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>

        <record id="a4_invoice" model="report.paperformat">
            <field name="name">A4 Invoice</field>
            <field name="default" eval="False"/>
            <field name="format">A4</field>
            <field name="margin_top">40</field>
            <field name="margin_bottom">45</field>
            <field name="margin_right">7</field>
            <field name="margin_left">7</field>
            <field name="orientation">Portrait</field>
            <field name="header_line">False</field>
            <field name="header_spacing">35</field>
            <field name="dpi">90</field>
        </record>

        <template id="document_format_zoopet.report_invoice_document_zoopet" inherit_id="account.report_invoice_document">

            <xpath expr="//t[@t-set='address']" position="replace">

                <div></div>


            </xpath>

            <xpath expr="//div[@class='page']" position="replace">

                 <t t-set="isInvoice" t-value="o.type"/>

        <!--Datos del docuumento -->
        <!-- Direcciones -->

    <!-- DIreccion de facturacion -->

    <div style="width:49%;float:left;clear:both;margin-right:1%;border:2px solid black;height:195px;">
        <div style="background-color:blue;color:white;text-align:center;">
            Dirección de facturacíon
        </div>
        <div t-if="o.partner_id" style="margin-left:2%;">
            <!-- nombre -->
            <div t-if="o.partner_id.name">
                <span t-field="o.partner_id.name"/>
            </div>
            <!-- nombre comercial -->
            <div t-if="o.partner_id.comercial">
                <span t-field="o.partner_id.comercial"/>
            </div>

            <!-- calle -->
            <div>
                <span t-field="o.partner_id.street"/>
            </div>
            <!-- CP, ciudad -->
            <div>
                <span t-if="o.partner_id.zip" t-field="o.partner_id.zip"/>
                <span t-if="o.partner_id.city" t-field="o.partner_id.city"/>
            </div>
            <!-- Provincia -->
            <div>
                <span t-if="o.partner_id.state_id.name" t-field="o.partner_id.state_id.name"/>
            </div>
            <!-- tlf -->
            <div>
                <span t-if="o.partner_id.phone">TLF.:</span><span t-if="o.partner_id.phone" t-field="o.partner_id.phone"/>
            </div>
            <!-- CIF/NIF -->
            <div>
                <span t-if="o.partner_id.vat">NIF/CIF: </span><span t-if="o.partner_id.vat" t-field="o.partner_id.vat"/>
            </div>
        </div>
    </div>

    <!-- Fin direccion de facturacion -->

        <!-- Direccion de envio -->
        <div style="width:49%;float:left;border:2px solid black;margin-left:1%;height:195px;">
        <div style="background-color:blue;color:white;text-align:center;">
            Dirección de envío
        </div>
        <div t-if="o.partner_id" style="margin-left:2%;">
            <!-- nombre -->
            <div t-if="o.partner_id.name">

                <span t-field="o.partner_id.name"/>
            </div>
            <!-- nombre comercial -->
            <div t-if="o.partner_id.comercial">
                <span t-field="o.partner_id.comercial"/>
            </div>
            <!-- calle -->
            <div>
                <span t-field="o.partner_shipping_id.street"/>
            </div>
            <!-- CP, ciudad -->
            <div>
                <span t-if="o.partner_shipping_id.zip" t-field="o.partner_shipping_id.zip"/>
                <span t-if="o.partner_shipping_id.city" t-field="o.partner_shipping_id.city"/>
            </div>
            <!-- Provincia -->
            <div>
                <span t-if="o.partner_shipping_id.state_id.name" t-field="o.partner_shipping_id.state_id.name"/>
            </div>
            <!-- tlf -->
            <div>
                <span t-if="o.partner_shipping_id.phone">TLF.:</span><span t-if="o.partner_shipping_id.phone" t-field="o.partner_shipping_id.phone"/>
            </div>
        </div>
    </div>

    <!-- Fin direccion de envio -->
    <!-- Fin direcciones -->

    <!-- datos documento -->
    <div style="width:49%;clear:both;float:left;margin-right:1%;margin-top:5px;font-size:0.9em;margin-bottom:50px;">
        <div style="width:50%;float:left;border:2px solid black;height:25px;">
            <span style="margin-left:2px;">
            <b><span>Factura: </span></b>
            </span>
            <span t-field="o.number"/>
        </div>
        <div style="width:50%;float:left;border-bottom:2px solid black;border-right:2px solid black;border-top:2px solid black;height:25px;">
            <span style="margin-left:2px;"><b>Fecha:</b></span><span t-field="o.create_date" t-options="{&quot;format&quot;: &quot;dd/MM/yyyy&quot;}"/>
        </div>
        <div style="width:50%;float:left;border-bottom:2px solid black;border-left:2px solid black;border-right:2px solid black;height:25px;">
            <span style="margin-left:2px;"><b>Cliente:</b></span>
            <span t-if="o.partner_id.parent_id" t-field="o.partner_id.parent_id.ref"/>
            <span t-if=" not o.partner_id.parent_id" t-field="o.partner_id.ref"/>
        </div>
        <div style="width:50%;float:left;border-bottom:2px solid black;border-right:2px solid black;height:25px;">
        <span style="margin-left:2px;"><b>Pedido:</b></span><span t-field="o.origin"/>
        </div>
    </div>
    <!-- fin datos documento -->
    <!-- observaciones -->
    <div style="width:49%;float:left;margin-left:1%;border:2px solid black;height:51px;margin-top:5px;">
        <span style="margin-left:2px;"><b>Observaciones:</b></span><span t-field="o.comment"/>
    </div>
    <!-- fin observaciones -->
    <!-- Fin datos documento -->

    <!--Datos del cliente -->

        <div id="informations" class="row mt32 mb32" style="display:none;">
            <div class="col-auto mw-100 mb-2" t-if="o.name" name="description">
                <strong>Description:</strong>
                <p class="m-0" t-field="o.name"/>
            </div>
            <div class="col-auto mw-100 mb-2" t-if="o.date_invoice" name="invoice_date">
                <strong>Invoice Date:</strong>
                <p class="m-0" t-field="o.date_invoice"/>
            </div>
            <div class="col-auto mw-100 mb-2" t-if="o.date_due and o.type == 'out_invoice' and o.state in ('open', 'in_payment', 'paid')" name="due_date">
                <strong>Due Date:</strong>
                <p class="m-0" t-field="o.date_due"/>
            </div>
            <div class="col-auto mw-100 mb-2" t-if="o.origin" name="origin">
                <strong>Source:</strong>
                <p class="m-0" t-field="o.origin"/>
            </div>
            <div class="col-auto mw-100 mb-2" t-if="o.partner_id.ref" name="customer_code">
                <strong>Customer Code:</strong>
                <p class="m-0" t-field="o.partner_id.ref"/>
            </div>
            <div name="reference" class="col-auto mw-100 mb-2" t-if="o.reference">
                <strong>Reference:</strong>
                <p class="m-0" t-field="o.reference"/>
            </div>
        </div>

        <!--Datos del docuumento -->

    <div style="width:50%;float:left;margin-top:-115px;margin-bottom:15px;display:none;">

        <h2 style="padding-top:30px;margin-left:50px;">
            <span t-if="o.type == 'out_invoice' and o.state in ('open', 'in_payment', 'paid')">Invoice</span>
            <span t-if="o.type == 'out_invoice' and o.state == 'draft'">Draft Invoice</span>
            <span t-if="o.type == 'out_invoice' and o.state == 'cancel'">Cancelled Invoice</span>
            <span t-if="o.type == 'out_refund'">Credit Note</span>
            <span t-if="o.type == 'in_refund'">Vendor Credit Note</span>
            <span t-if="o.type == 'in_invoice'">Vendor Bill</span>
        </h2>

        <span style="width:20%;display:inline-block">Número: </span>
        <span style="display:inline-block;width:80%;" t-field="o.number"/>

        <span style="width:20%;display:inline-block">Fecha: </span>
        <span style="display:inline-block;width:80%;" t-field="o.date_invoice" t-options="{&quot;format&quot;: &quot;MM-dd-yyyy&quot;}"/>
            <div t-if="o.origin">
            <span style="width:20%;display:inline-block">Pedido: </span>
            <span style="display:inline-block;width:80%;" t-field="o.origin"/>
        </div>

        <div t-if="o.partner_id.comercial">
            <span style="width:20%;display:inline-block">Cliente: </span>
            <span style="display:inline-block;width:80%;" t-field="o.partner_id.comercial"/>
        </div>

        <div t-else="">
            <span style="width:20%;display:inline-block">Cliente: </span>
            <span style="display:inline-block;width:80%;" t-field="o.partner_id.name"/>
        </div>
        <div t-if="o.partner_id.vat">
            <span style="width:20%;display:inline-block">NIF/CIF: </span>
            <span style="display:inline-block;width:80%;" t-field="o.partner_id.vat"/>
        </div>

    </div>

    <!--  Descuentos  -->
    <t t-set="total_discount1" t-value="0"/>
    <t t-set="total_discount3" t-value="0"/>
    <t t-set="delivery" t-value="0"/>
    <t t-foreach="o.invoice_line_ids" t-as="line">
        <t t-set="line_discount1" t-value="0"/>
        <t t-set="unit_price" t-value="line.price_unit"/>
        <t t-if="line.product_id">
        <t t-if="line.discount != 0">
            <t t-set="line_discount1" t-value="unit_price * line.discount / 100 * line.quantity"/>
            <t t-set="unit_price" t-value="unit_price - (unit_price * line.discount / 100)"/>
        </t>
        <t t-if="line_discount1 != 0">
            <t t-set="total_discount1" t-value="total_discount1 + line_discount1"/>
        </t>
    </t>
</t>
<!--  fin descuentos  -->

    <!--Fin datos documento -->

    <t t-set="display_discount" t-value="any([l.discount for l in o.invoice_line_ids])"/>

        <!-- lineas -->

        <div style="clear:both;font-size:0.7em;padding-bottom:20px;width:100%;">
            <div style="height:14px; width:10%; display:block; float:left; margin-left:-15px;font-size:1.2em;">
                <span><b>Código</b></span>
            </div>
            <div style="height:14px; width:41%; display:block;float:left;font-size:1.2em;">
                <span><b>Descripción</b></span>
            </div>
            <div style="height:14px; width:7%; display:block; float:left;font-size:1.2em;text-align:right;">
                <span><b>IVA%</b></span>
            </div>
            <div style="height:14px; width:10%; display:block; float:left;font-size:1.2em;text-align:right;">
                <span><b>Unds</b></span>
            </div>
            <div style="height:14px; width:9%; display:block;float:left;font-size:1.2em;text-align:right;">
                <span><b>Precio/U</b></span>
            </div>
            <div style="height:14px; width:8%; display:block; float:left;font-size:1.2em;text-align:right;">
                <t t-if="total_discount1 != 0">
                    <span><b>Desc.%</b></span>
                </t>
            </div>

            <div style="height:14px; width:8%; display:block; float:left;font-size:1.2em;text-align:right;">
                <span><b>Neto</b></span>
            </div>
            <div style="height:14px; width:7%; display:block; float:left;font-size:1.2em;text-align:right;">
                <span><b>Importe</b></span>
            </div>
        </div>

        <hr style="height:2px;width:101%;background-color:black;margin-left:-15px;margin-top:-5px;"/>

        <!-- marca de agua-->
        <div class="watermark" style="position:absolute;opacity:0.25;font-size:3em;width:100%;text-align:center;z-index:1000;-webkit-transform: rotate(-37deg);margin-top:150px;">
            <p>*FACTURA*</p>
        </div>
        <!-- fin marca de agua -->

        <!-- Variables -->

        <t t-set="current_subtotal" t-value="0"/>
        <t t-set="current_discount" t-value="0"/>
        <t t-set="current_bruto" t-value="0"/>
        <t t-set="lineas" t-value="0"/>
        <t t-set="portes" t-value="0"/>

        <!-- IVAS -->

        <t t-set="importeIva21" t-value="0"/>
        <t t-set="importeRec52" t-value="0"/>
        <t t-set="importeIva21Total" t-value="0"/>
        <t t-set="importeRec52Total" t-value="0"/>
        <t t-set="importeIva10" t-value="0"/>
        <t t-set="importeRec14" t-value="0"/>
        <t t-set="importeIva10Total" t-value="0"/>
        <t t-set="importeRec14Total" t-value="0"/>
        <t t-set="importeIva4" t-value="0"/>
        <t t-set="importeRec05" t-value="0"/>
        <t t-set="importeIva4Total" t-value="0"/>
        <t t-set="importeRec05Total" t-value="0"/>

        <t t-set="weight" t-value="0"/>

        <!-- fin ivas -->

        <!-- Fin variables -->

        <t t-foreach="o.invoice_line_ids" t-as="line">
            <!-- calculo peso -->
            <t t-if="line.product_id.weight">
                <t t-set="weight" t-value="weight + line.product_id.weight * line.quantity"/>
            </t>

            <!-- fin calculo peso -->

            <t t-set="productName" t-value="line.product_id.name"/>
            <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
            <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>

            <!-- calculos del descuento -->
            <t t-set="current_discount" t-value="current_discount + (line.quantity * line.price_unit) - line.price_subtotal" groups="sale.group_discount_per_so_line"/>
            <!-- Fin calculos del descuento -->

            <!-- Calculos del bruto -->
            <t t-set="current_bruto" t-value="current_bruto + (line.quantity * line.price_unit)" groups="account.group_show_line_subtotals_tax_excluded"/>
            <!-- Fin calculos del bruto -->

            <!-- fin si es entrega -->

            <!--Si es nota -->

            <t t-if="not line.product_id">
                <div class="text-left" style="width:100%;margin-left:-15px;font-size:0.9em;">
                    <span style="margin-left:15px;">NOTA:</span> <span t-field="line.name"/>
                </div>
            </t>

            <!-- Fin si es nota -->

            <t t-if="line.product_id">

            <!-- verificar que no sea portes = 0€ -->
            <t t-set="mostrar" t-value="True"/>
            <t t-if="line.price_unit &lt; 0.01">
                <t t-if="line.product_id.type == 'service'">
                    <t t-set="mostrar" t-value="False"/>
                </t>
            </t>

            <t t-if="mostrar == True">
            <!-- verificar que no sea portes = 0€ -->

                <!-- codigo -->
                    <div style="font-size:0.7em;clear:both;margin-top:-13px;">
                    <div style="width:10%; display:block; float:left; margin-left:-15px;">
                        <t t-if="line.product_id.default_code">
                            <span t-field="line.product_id.default_code"/>
                        </t>
                        <t t-else="">
                            <span style="color:white;">abc</span>
                        </t>
                    </div>
                    <!-- Fin codigo -->

                    <!-- Descripcion -->
                    <div style="width:41%; display:block;float:left;">
                        <t t-if="line.name">
                        <t t-set="productName" t-value="line.name"/>
                        <t t-set="name_num" t-value="productName.find(']') + 1 "/>
                        <t t-set="name" t-value="productName[name_num:]"/>
                            <span t-esc="name"/>
                        </t>
                        <t t-else="">
                            <span style="color:white;">abc</span>
                        </t>
                    </div>
                    <!-- Fin descripcion -->

                    <!-- % de IVA -->
                    <div style="width:7%; display:block; float:left;text-align:right;">
                        <t t-if="o.sale_type_id.name == 'Serie C'">
                            <span style="color:white;">abc</span>
                        </t>
                        <t t-else="">
                            <t t-set="IVALin" t-value="0"/>
                            <t t-foreach="line.invoice_line_tax_ids" t-as="tax">
                                <t t-set="tax_name" t-value="tax.name"/>
                                <t t-set="isIVA" t-value="tax_name.find('IVA')"/>
                                <t t-if="isIVA &gt; -1">
                                    <span t-esc="'%.2f'%tax.amount"/>
                                </t>
                            </t>
                        </t>
                        <t t-if="not line.invoice_line_tax_ids">
                            <span style="color:white;">abc</span>
                        </t>
                    </div>

                    <!-- Fin % de IVA -->

                    <!-- Cantidad entregada -->
                    <div style="width:10%;  display:block; float:left;text-align:right">
                        <span t-esc="'%.2f'%line.quantity"/>
                    </div>
                    <!-- Fin cantidad entregada -->

                    <!--Precio / U -->
                    <div style="width:9%; display:block;float:left; text-align:right;">
                        <span t-field="line.price_unit" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                    </div>
                    <!-- Fin precio / u -->

                    <!-- Descuento -->
                    <div t-if="line.discount != 0.00" style="width:8%; display:block; float:left;text-align:right;">
                        <t t-if="line.discount != 0.00">
                            <span t-field="line.discount"/>
                        </t>
                        <t t-else="">
                            <span style="color:white;">abc</span>
                        </t>
                    </div>
                    <div t-else="" style="width:8%;display:block; float:left;text-align:right;">
                        <span style="color:white;">abc</span>
                    </div>
                    <!-- Fin descuento -->

                    <!-- Precio Neto / u -->
                    <div style="width:8%;  display:block; float:left;text-align:right;">
                        <t t-set="neto_linea" t-value="line.price_unit"/>
                        <t t-if="line.discount != 0.00">
                            <t t-set="neto_linea" t-value="neto_linea - (neto_linea * line.discount /100)"/>
                        </t>
                        <span t-esc="neto_linea" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                    </div>
                    <!-- Fin precio neto / u -->

                    <!-- Precio total linea -->
                    <div style="width:64px;  display:block; float:left;text-align:right;">
                        <t t-set="total_linea" t-value="neto_linea * line.quantity"/>
                        <span t-esc="line.price_subtotal" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                    </div>

                    <t t-if="o.sale_type_id.name != 'Serie C'">

                        <t t-foreach="line.invoice_line_tax_ids" t-as="tax">
                            <t t-set="tax_name" t-value="tax.name"/>
                            <t t-set="isIVA" t-value="tax_name.find('IVA')"/>

                            <!-- acumulacion de las cantidad de cada iva ventas -->

                          <!--  <t t-if="tax.amount == 21.0">
                                <t t-set="importeIva21" t-value="importeIva21 + (total_linea * 0.21)"/>
                                <t t-set="importeIva21Total" t-value="importeIva21Total + total_linea"/>
                            </t>
                            <t t-if="tax.amount == 5.2">
                                <t t-set="importeRec52" t-value="importeRec52 + (total_linea * 0.052)"/>
                            </t>

                            <t t-if="tax.amount == 10.0">
                                <t t-set="importeIva10" t-value="importeIva10 + (total_linea * 0.10)"/>
                                <t t-set="importeIva10Total" t-value="importeIva10Total + total_linea"/>
                            </t>

                            <t t-if="tax.amount == 1.4">
                                <t t-set="importeRec14" t-value="importeRec14 + (total_linea * 0.014)"/>
                            </t>

                            <t t-if="tax.amount == 4.0">
                                <t t-set="importeIva4" t-value="importeIva4 + (total_linea * 0.04)"/>
                                <t t-set="importeIva4Total" t-value="importeIva4Total + total_linea"/>
                            </t>

                            <t t-if="tax.amount == 0.50">
                                <t t-set="importeRec05" t-value="importeRec05 + (total_linea * 0.005)"/>
                            </t>
                                -->
                            <!-- fin acumulaciones de las cantuidades de iva ventas -->
                        </t>
                    </t>

                    <!-- Fin precio total de linea -->

                    <!--<td t-if="has_serial_number and move_line.lot_name" groups="stock.group_lot_on_delivery_slip">
                        <span t-field="move_line.lot_name"/>
                    </td>
                    <td t-else="" groups="stock.group_lot_on_delivery_slip">
                        <span t-field="move_line.lot_id.name"/>
                    </td>-->
                    <!--<td class="text-center">
                        <span t-field="move_line.qty_done"/>
                        <span t-field="move_line.product_uom_id"/>
                    </td>-->

                </div>
                </t>
            </t>
        </t>

            <hr style="height:2px;width:101%;background-color:black;margin-left:-15px;"/>

            <!-- fin lineas -->

            <table class="table table-sm o_main_table" name="invoice_line_table" style="display:none;">
                <thead>
                    <tr style="border-top: 2px solid black;border-bottom: 2px solid black;">
                        <th class="text-left">Código</th>

                        <th class="text-left">Descripcion</th>

                        <th class="text-center">IVA</th>

                        <th class="text-center">Unidades</th>

                        <th class="text-center">Precio</th>

                        <th class="text-center" groups="sale.group_discount_per_so_line">
                            <span>Dto.</span>
                            <t t-set="colspan"/>
                        </th>

                        <th class="text-right">
                            <span>Neto</span>
                        </th>
                        <th class="text-right">
                            <span>Importe</span>
                        </th>
                    </tr>
                </thead>
                <tbody class="invoice_tbody">
                    <t t-set="current_subtotal" t-value="0"/>

                    <t t-foreach="o.invoice_line_ids" t-as="line">

                        <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                        <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>

                        <tr t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                            <t t-if="not line.display_type" name="account_invoice_line_accountable">
                                <!-- Codigo -->
                                <td><span t-field="line.product_id.default_code"/></td>
                                <!-- FIn codigo -->

                                <!-- Descripcion -->
                                <td name="account_invoice_line_name"><span t-field="line.product_id.name"/></td>
                                <!-- Fin descripcion -->

                            <!-- IVA -->
                                <td t-attf-class="text-left {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                    <span t-esc="', '.join(map(lambda x: str(x.amount), line.invoice_line_tax_ids))"/>
                                </td>
                            <!-- Fin IVA -->

                            <!-- Unidades -->
                                <td class="d-none"><span t-field="line.origin"/></td>
                                <td class="text-right">
                                    <span t-esc="'%.2f'%line.quantity"/>
                                    <span t-field="line.uom_id" groups="uom.group_uom"/>
                                </td>
                            <!-- Fin Unidades -->

                            <!-- Precio -->
                                <td t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                    <span t-field="line.price_unit" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                </td>
                            <!-- Fin precio -->

                            <!-- Descuento -->
                                <t t-if="display_discount">
                                    <td t-if="display_discount" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <span t-field="line.discount" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                    </td>
                                </t>
                                <t t-else="">
                                <td/>
                                </t>
                            <!-- Fin descuento -->
                            <!-- NETO -->
                                <td class="text-right o_price_total">
                                    <span t-field="line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                    <span t-field="line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                </td>
                            <!-- Fin Neto -->

                            <!-- Importe total -->

                                <td class="text-right o_price_total">
                                    <span t-field="line.price_total" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                </td>

                            <!-- Fin importe total -->
                            </t>

                            <t t-if="line.display_type == 'line_section'">
                                <td colspan="99">
                                    <span t-field="line.name"/>
                                </td>
                                <t t-set="current_section" t-value="line"/>
                                <t t-set="current_subtotal" t-value="0"/>
                            </t>
                            <t t-if="line.display_type == 'line_note'">
                                <td colspan="99">
                                    <span t-field="line.name"/>
                                </td>
                            </t>
                        </tr>

                        <t t-if="current_section and (line_last or o.invoice_line_ids[line_index+1].display_type == 'line_section')">
                            <tr class="is-subtotal text-right">
                                <td colspan="99">
                                    <strong class="mr16">Subtotal</strong>
                                    <span t-esc="current_subtotal" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                </td>
                            </tr>
                        </t>
                    </t>
                </tbody>
            </table>

            <!-- totales y calculos -->

        <t t-set="importeIva" t-value="0"/>
        <t t-set="importeRecargo" t-value="0"/>

        <t t-foreach="o.amount_by_group" t-as="amount_by_group">
            <t t-set="isIVA" t-value="amount_by_group[0].find('IVA')"/>
                <t t-if="isIVA == 0">
                    <t t-set="importeIva" t-value="importeIva + amount_by_group[1]"/>
                </t>
                <t t-else="">
                    <t t-set="importeRecargo" t-value="importeRecargo + amount_by_group[1]"/>
                </t>
            </t>

            <div class="clearfix" style="display:none;">
                <div id="total" class="row">
                    <div t-attf-class="#{'col-4' if report_type != 'html' else 'col-sm-7 col-md-5'} ml-auto">
                        <table class="table table-sm">
                            <tr class="border-black o_subtotal" style="">
                                <td><strong>Subtotal</strong></td>
                                <td class="text-right">
                                    <span t-field="o.amount_untaxed"/>
                                </td>
                            </tr>
                            <t t-foreach="o.amount_by_group" t-as="amount_by_group">
                                <tr style="">
                                    <t t-if="len(o.tax_line_ids) == 1 and o.amount_untaxed == amount_by_group[2]">
                                        <td><span t-esc="amount_by_group[0]"/></td>
                                        <td class="text-right o_price_total">
                                            <span t-esc="amount_by_group[3]"/>
                                        </td>
                                    </t>
                                    <t t-else="">
                                        <td>
                                            <span t-esc="amount_by_group[0]"/>
                                            <span>&amp;nbsp;<span>on</span>
                                                <t t-esc="amount_by_group[4]"/>
                                            </span>
                                        </td>
                                        <td class="text-right o_price_total">
                                            <span t-esc="amount_by_group[3]"/>
                                        </td>
                                    </t>
                                </tr>
                            </t>
                            <tr class="border-black o_total">
                                <td><strong>Total</strong></td>
                                <td class="text-right">
                                    <span t-field="o.amount_total" />
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

        <!-- desgloses IVA y RECARAGO  serie C-->
        <t t-if="o.sale_type_id.name == 'Serie C'">

            <div style="width:40%;margin-left:8%;float:right;font-size:0.8em;">
                <!-- base imponible sin descuentos -->

             <t t-if="o.amount_global_discount != 0">
                    <div style="width:50%;float:left;">
                        <span>Bruto</span>
                    </div>
                    <div style="width:50%;float:left;text-align:right;">
                        <span t-esc="o.amount_untaxed_before_global_discounts" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                    </div>
                    <!-- Fin base imponible sin descuentos -->
                </t>
                <t t-else="">
                     <!-- Base imponible -->

                    <div style="width:50%;float:left;">
                        <span>Bruto</span>
                    </div>
                    <div style="width:50%;float:left;text-align:right;">
                        <span t-esc="o.amount_untaxed_before_global_discounts" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                    </div>
                </t>
            <!-- Fin base imponible -->

                 <!-- Descuentos Globales -->

                <t t-set="amount_untaxed_before_global_discounts" t-value="o.amount_untaxed_before_global_discounts"/>

                <t t-foreach="o.global_discount_ids" t-as="discount">
                    <div t-if="o.amount_global_discount != 0" style="width:50%;float:left;clear:both;">
                        <span t-esc="discount.name"/>
                        <span t-esc="discount.discount"/>
                        <span>%</span>
                    </div>
                    <div t-if="o.amount_global_discount != 0" style="width:50%;float:left;text-align:right;">
                        <t t-set="global_discount_line" t-value="(amount_untaxed_before_global_discounts * discount.discount / 100)"/>
                        <t t-set="amount_untaxed_before_global_discounts" t-value="amount_untaxed_before_global_discounts - global_discount_line"/>
                        <t t-set="discount_global" t-value="global_discount_line * -1" />
                        <span t-esc="discount_global" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"></span>
                    </div>
                </t>

                <!-- Descuentos Globales -->
                <div t-if="o.amount_global_discount != 0" style="width:50%;float:left;">
                    <span>Total descuentos</span>
                </div>
                <div t-if="o.amount_global_discount != 0" style="width:50%;float:left;text-align:right;">
                    <span t-esc="o.amount_global_discount" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                </div>
                <!-- Fin Descuentos Globales -->

                <!-- Base imponible -->
                <div style="width:50%;float:left;">
                    <span>Base imponible</span>
                </div>
                <div style="width:50%;float:left;text-align:right;">
                    <span t-esc="o.amount_untaxed" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                </div>
                <!-- Fin base imponible -->


            <!-- Total -->

            <div style="width:50%;float:left;">
                <b><span>Total </span></b>
            </div>
            <div style="width:50%;float:left;text-align:right;">
                <b><span t-esc="o.amount_total" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/></b>
            </div>
            <!-- Fin Desglose -->

            <hr style="height:2px;width:100%;background-color:black;"/>
            </div>
            <div style="clear:both;margin-top:5px;">
                <t t-set="noIva" t-value="1"/>
                <!--<p>*Exenta de IVA, según artículo 20, Ley 37/1992 de IVA.</p>-->
            </div>

        </t>

        <!--Fin desgloses IVA y RECARAGO serie C -->

        <!-- desgloses IVA y RECARAGO -->
        <t t-if="o.sale_type_id.name != 'Serie C'">
        <!-- Desglose -->

            <div style="width:40%;margin-left:8%;float:right;font-size:0.7em;margin-right:1.7%;margin-top:-15px;">

                 <!-- Base imponible sin descuentos -->
                <t t-if="o.amount_global_discount != 0">
                    <div style="width:50%;float:left;">
                        <span>Bruto</span>
                    </div>
                    <div style="width:50%;float:left;text-align:right;">
                        <span t-esc="o.amount_untaxed_before_global_discounts" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                    </div>
                    <!-- Fin base imponible sin descuentos -->
                </t>
                <t t-else="">
                     <!-- Base imponible -->

                    <div style="width:50%;float:left;">
                        <span>Bruto</span>
                    </div>
                    <div style="width:50%;float:left;text-align:right;">
                        <span t-esc="o.amount_untaxed_before_global_discounts" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                    </div>
                </t>
            <!-- Fin base imponible -->

                <!-- Descuentos Globales -->

                <t t-set="amount_untaxed_before_global_discounts" t-value="o.amount_untaxed_before_global_discounts"/>

                <t t-foreach="o.global_discount_ids" t-as="discount">
                    <div t-if="o.amount_global_discount != 0" style="width:50%;float:left;clear:both;">
                        <span t-esc="discount.name"/>
                        <span t-esc="discount.discount"/>
                        <span>%</span>
                    </div>
                    <div t-if="o.amount_global_discount != 0" style="width:50%;float:left;text-align:right;">
                        <t t-set="global_discount_line" t-value="(amount_untaxed_before_global_discounts * discount.discount / 100)"/>
                        <t t-set="amount_untaxed_before_global_discounts" t-value="amount_untaxed_before_global_discounts - global_discount_line"/>
                        <t t-set="discount_global" t-value="global_discount_line * -1" />
                        <span t-esc="discount_global" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"></span>
                    </div>
                </t>

                <!-- Descuentos Globales -->
                <div t-if="o.amount_global_discount != 0" style="width:50%;float:left;">
                    <span>Total descuentos</span>
                </div>
                <div t-if="o.amount_global_discount != 0" style="width:50%;float:left;text-align:right;">
                    <span t-esc="o.amount_global_discount" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                </div>
                <!-- Fin Descuentos Globales -->

                <!-- Base imponible -->
                <div style="width:50%;float:left;">
                    <span>Base imponible</span>
                </div>
                <div style="width:50%;float:left;text-align:right;">
                    <span t-esc="o.amount_untaxed" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                </div>
                <!-- Fin base imponible -->

                <!-- desglose de Impuestos -->
                <div style="clear:both;">
                    <t t-foreach="o.amount_by_group" t-as="amount_by_group">
                        <div style="">
                            <t t-if="amount_by_group[3] == 1 and doc.amount_untaxed == amount_by_group[2]">
                                <div>
                                    <span t-esc="amount_by_group[0]"/>
                                    <span>en</span>
                                    <t t-esc="amount_by_group[2]" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                    <span t-esc="amount_by_group[1]" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                </div>
                            </t>
                            <t t-else="">
                                <div style="width:60%;float:left;">
                                    <span t-esc="amount_by_group[0]"/>
                                    <span>en</span>
                                    <span t-esc="amount_by_group[2]" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                </div>
                                <div style="width:40%;float:left;text-align:right;">
                                    <span t-esc="amount_by_group[1]" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                </div>
                            </t>
                        </div>
                    </t>
                </div>
                <!-- Fin desglose impuestos -->

                <!-- Total -->

                <div style="width:50%;float:left;">
                    <b><span>Total </span></b>
                </div>
                <div style="width:50%;float:left;text-align:right;">
                    <b><span t-esc="o.amount_total" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/></b>
                </div>
                <!-- Fin Desglose -->

                <hr style="height:2px;width:101%;background-color:black;"/>
            </div>

        </t>

        <!-- Metodo de pago -->
            <!--<p t-if="o.payment_term_id" name="payment_term" style="clear:both;">
            <span t-field="o.payment_term_id.note"/>
        </p> -->

        <t t-if="o.payment_term_id">
            <t t-set="plazos" t-value="o.payment_term_id.name"/>
        </t>

        <!-- Fin metodo de pago -->
        <!-- Leyenda Factura -->

        <!--  <div style="clear:both;">
            <div style="display:block;" t-if="o.partner_shipping_id.country_id.name == 'Portugal'" >
                <span style="display:block;">Para pagos por transferencia:</span>
                <span style="display:block;"> BANCO: BPI</span>
                <span style="display:block;">IBAN: PT50 0010 0000 4423 5081 5019 1</span>
            </div>
            <div style="display:block;" t-if="o.partner_shipping_id.country_id.name != 'Portugal'" >
                <span style="display:block;">Para pagos por transferencia:</span>
                <span style="display:block;"> BANCO: SANTANDER</span>
                <span style="display:block;">IBAN: ES94 0049 2336 4225 1408 4617</span>
            </div>

            <span style="display:block;">La posesión de esta Factura no justifica su pago</span>-->
            <!--<span style="display:block;" >Las incidencias en transporte (roturas, falta de mercancía, etc.), deberán ser comunicadas antes de 24 horas.</span>-->
        <!-- </div>-->

        <!-- Fin leyenda Factura -->

        <!--  <p t-if="o.comment" name="comment">
            <span t-field="o.comment"/>
        </p> -->

        <p t-if="o.fiscal_position_id.note" name="note">
            <span t-field="o.fiscal_position_id.note"/>
        </p>
        <div id="qrcode" t-if="(o.partner_id.country_id.code in ['BE', 'AT', 'DE', 'FI', 'NL']) and (o.company_id.qr_code) and (o.currency_id.name == 'EUR') and (o.partner_bank_id.acc_number != False)">
            <p t-if="(o.partner_bank_id.qr_code_valid)">
                <strong class="text-center">Scan me with your banking app.</strong><br/><br/>
                <img class="border border-dark rounded" t-att-src="o.partner_bank_id.build_qr_code_url(o.residual,(o.reference) if (o.reference) else o.number)"/>
            </p>
            <p t-if="(o.partner_bank_id.qr_code_valid == False)">
                <strong class="text-center">The SEPA QR Code informations are not set correctly.</strong><br/>
            </p>
        </div>

        <!-- Inversion de sujeto pasivo -->

        <t t-if="o.sale_type_id.name == 'Serie C'">

            <!-- Porte y precio -->

            <t t-set="PortPrice" t-value="0"/>

            <!-- Fin Porte y precios -->

            <t t-foreach="o.invoice_line_ids" t-as="line">
                <t t-if="line.product_id.default_code == 'ENT0'">
                    <t t-set="PortPrice" t-value="line.price_unit"/>
                </t>
            </t>

            <t t-if="PortPrice != 0">
                <span>Inversión del sujeto pasivo</span>
            </t>
        </t>

        <!-- Fin inversión del sujeto pasivo-->

            </xpath>

        </template>

        <!-- <template id="report_invoice_document_ch_address" inherit_id="account.report_invoice_document_with_payments">

             <xpath expr="/data" position="replace">

                 <div></div>

             </xpath>

         </template>-->

    </data>
</odoo>
