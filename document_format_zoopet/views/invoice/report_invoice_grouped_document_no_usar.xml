<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<data>
        <template id="document_format_zoopet.report_invoice_not_use_grouped_document">
            <t t-name="document_format_zoopet.report_invoice_not_use_grouped_document">
                <t t-call="web.external_layout">
                    <div class="page">
                    <t t-set="not_use_invoice" t-value="1"/>
                    <t t-set="doc_name" t-value="o.name" />
                    <t t-set="isInvoice" t-value="o.type" />
                    <t t-set="delivery_method" t-value="o.delivery_method" />
                    <t t-if="isInvoice == 'out_invoice'">
                        <t t-set="lumps_number" t-value="o.lumps_number" />
                        <t t-set="pallets_number" t-value="o.pallets_number" />
                    </t>
                    <t t-set="mostrarFrasePortes" t-value="False" />
                    <t t-foreach="o.invoice_line_ids" t-as="line">
                        <t t-if="line.price_unit &gt; 0.00">
                            <t t-if="line.product_id.type == 'service'">
                                <t t-set="mostrarFrasePortes" t-value="True" />
                            </t>
                        </t>
                    </t>
                    <t t-set="serieInv" t-value="o.sale_type_id.name" />
                    <!-- Buscamos el tipo en el number de la rectificativa -->
                    <t t-set="isRecT" t-value="doc_name.find('T')" />
				    <t t-set="isRecP" t-value="doc_name.find('P')" />
                    <!-- Fin buscamos el tipo en el number de la rectificativa -->
                    <!-- Datos del docuumento -->
                    <!-- si tiene copias -->
                    <t t-if="iteration">
                        <t t-set="inv_copy" t-value="iteration" />
                        <t t-if="iteration &lt; 2">
                        </t>
                        <t t-else="">
                            <div style="display:block;width:100%;clear:both;text-align:right;">
                                <b>
                                    <span>
                                        Copia
                                    </span>
                                    <span t-esc="iteration -1">
                                    </span>
                                </b>
                            </div>
                        </t>
                    </t>
                    <!-- si tiene copias -->
                    <!-- Direcciones -->
                    <!-- DIreccion de facturacion -->
                    <div style="width:49%;float:left;clear:both;margin-right:0.5%;border:2px solid black;height:223px;">
                        <div style="background-color:blue;color:white;text-align:center;">
                            Dirección de facturacíon
                        </div>
                        <div t-if="o.partner_id" style="margin-left:2%;">
                            <!-- nombre -->
                            <t t-set="partner_id" t-value="o.partner_id" />
                            <t t-if="partner_id.parent_id">
                                <t t-set="partner_id" t-value="o.partner_id.parent_id" />
                            </t>
                            <div t-if="partner_id.name">
                                <t t-set="partner_name" t-value="partner_id.name"/>
							    <t t-set="partner_num" t-value="partner_name.find('(') - 1 " />
                                <t t-if="partner_num &gt; 0">
								    <t t-set="partner_name" t-value="partner_name[:partner_num]" />
							    </t>
							    <span t-esc="partner_name" />
                            </div>
                            <!-- nombre comercial -->
                            <div t-if="partner_id.comercial">
                                <span t-field="o.partner_id.comercial" />
                            </div>
                            <!-- calle -->
                            <div>
                                <span t-field="o.partner_id.street" />
                            </div>
                            <!-- calle 2 -->
                            <div>
                                <span t-field="o.partner_id.street2" />
                            </div>
                            <!-- CP, ciudad -->
                            <div>
                                <span t-if="o.partner_id.zip" t-field="o.partner_id.zip" />
                                <span t-if="o.partner_id.city" t-field="o.partner_id.city" />
                            </div>
                            <!-- Provincia -->
                            <div>
                                <span t-if="o.partner_id.state_id.name" t-field="o.partner_id.state_id.name" />
                            </div>
                            <!-- tlf -->
                            <div>
                                <span t-if="o.partner_id.phone">
                                    TLF.:
                                </span>
                                <span t-if="o.partner_id.phone" t-field="o.partner_id.phone" />
                                <span t-if="o.partner_id.mobile">, </span><span t-if="o.partner_id.mobile" t-field="o.partner_id.mobile"/>
                            </div>
                            <!-- CIF/NIF -->
                            <div>
                                <span t-if="o.partner_id.vat">
                                    NIF/CIF:
                                </span>
                                <span t-if="o.partner_id.vat" t-field="o.partner_id.vat" />
                            </div>
                            <!-- Nota -->
                            <t t-if="o.partner_id.parent_id">
                                <div t-if="o.partner_id.comment">
                                    <span>
                                        Nota:
                                    </span>
                                    <span t-field="o.partner_id.comment" />
                                </div>
                            </t>
                        </div>
                    </div>
                    <!-- Fin direccion de facturacion -->
                    <!-- Direccion de envio -->
                    <div style="width:49%;float:left;border:2px solid black;margin-left:0.5%;height:223px;">
                        <div style="background-color:blue;color:white;text-align:center;">
                            Dirección de envío
                        </div>
                        <div t-if="o.partner_id" style="margin-left:2%;">
                            <!-- nombre -->
                            <t t-set="partner_id" t-value="o.partner_id" />
                            <t t-if="partner_id.parent_id">
                                <t t-set="partner_id" t-value="o.partner_id.parent_id" />
                            </t>
                            <div t-if="partner_id.name">
                                <t t-set="partner_name" t-value="partner_id.name"/>
							    <t t-set="partner_num" t-value="partner_name.find('(') - 1 " />
                                <t t-if="partner_num &gt; 0">
								    <t t-set="partner_name" t-value="partner_name[:partner_num]" />
							    </t>
							    <span t-esc="partner_name" />
                            </div>
                            <!-- nombre comercial -->
                            <div t-if="partner_id.comercial">
                                <span t-field="partner_id.comercial" />
                            </div>
                            <!-- calle -->
                            <div>
                                <span t-field="o.partner_shipping_id.street" />
                            </div>
                            <!-- calle 2 -->
                            <div>
                                <span t-field="o.partner_shipping_id.street2" />
                            </div>
                            <!-- CP, ciudad -->
                            <div>
                                <span t-if="o.partner_shipping_id.zip" t-field="o.partner_shipping_id.zip" />
                                <span t-if="o.partner_shipping_id.city" t-field="o.partner_shipping_id.city" />
                            </div>
                            <!-- Provincia -->
                            <div>
                                <span t-if="o.partner_shipping_id.state_id.name" t-field="o.partner_shipping_id.state_id.name" />
                            </div>
                            <!-- tlf -->
                            <div>
                                <span t-if="o.partner_shipping_id.phone">
                                    TLF.:
                                </span>
                                <span t-if="o.partner_shipping_id.phone" t-field="o.partner_shipping_id.phone" />
                                 <span t-if="o.partner_shipping_id.mobile">, </span><span t-if="o.partner_shipping_id.mobile" t-field="o.partner_shipping_id.mobile"/>
                            </div>
                            <!-- Nota -->
                            <t t-if="o.partner_id != o.partner_shipping_id">
                                <div t-if="o.partner_shipping_id.comment">
                                    <span>
                                        Nota:
                                    </span>
                                    <span t-field="o.partner_shipping_id.comment" />
                                </div>
                            </t>
                        </div>
                    </div>
                    <!-- Fin direccion de envio -->
                    <!-- Fin direcciones -->
                    <!-- datos documento -->
                    <div style="width:49.5%;clear:both;float:left;margin-right:0.5%;margin-top:5px;font-size:0.9em;margin-bottom:5px;">
                        <div style="width:49.5%;float:left;border:2px solid black;height:25px;">
                            <span style="margin-left:2px;">
								<t t-if="isInvoice == 'out_invoice'">

										<b><span style="font-size:0.8em;">
											Factura:
										</span></b>


								</t>
								<t t-else="isInvoice == 'out_refund'">

											<b><span style="font-size:0.8em;">
												Rectificativa:
											</span></b>

								</t>
							</span>
                            <span t-field="o.name" />
                        </div>
                        <div style="width:49%;float:left;border-bottom:2px solid black;border-right:2px solid black;border-top:2px solid black;height:25px;">
                            <span style="margin-left:2px;">
                                <b>
                                    Fecha:
                                </b>
                            </span>
                            <span t-field="o.create_date" t-options="{&quot;format&quot;: &quot;dd/MM/yyyy&quot;}" />
                        </div>
                        <div style="width:49.5%;float:left;border-bottom:2px solid black;border-left:2px solid black;border-right:2px solid black;height:25px;">
                            <span style="margin-left:2px;">
                                <b>
                                    Cliente:
                                </b>
                            </span>
                            <span t-if="o.partner_id.parent_id" t-field="o.partner_id.parent_id.ref" />
                            <span t-if=" not o.partner_id.parent_id" t-field="o.partner_id.ref" />
                        </div>
                        <div style="width:49%;float:left;border-bottom:2px solid black;border-right:2px solid black;height:25px;">
                            <t t-set="origin_label" t-value="'Pedido: '" />
                            <t t-if="isInvoice == 'out_refund'">
                                <t t-set="origin_label" t-value="'Referencia :'" />
                                <t t-if="not o.refund_invoice_id">
                                    <t t-set="name_with_type" t-value="o.refund_invoice_name" />
                                </t>
                                <t t-else="">
                                    <t t-set="name_with_type" t-value="o.invoice_origin" />
                                </t>
                            </t>
                            <t t-else="">
                                <t t-set="name_with_type" t-value="o.sale_type_id.journal_id.code + '/' + o.invoice_origin" />
                            </t>
                            <t t-set="origin_num" t-value="name_with_type.find(',')"/>
							<t t-if="origin_num &gt; 0">
							</t>
							<t t-else="">
								<b>
							    	<span style="margin-left:2px;" t-esc="origin_label" />
								</b>
								<span t-esc="name_with_type" />
							</t>
                        </div>
                    </div>
                    <!-- fin datos documento -->
                    <!-- observaciones -->
                    <div style="width:49%;float:left;margin-left:0.5%;border:2px solid black;height:51px;margin-top:5px;">
                        <t t-if="isInvoice == 'out_refund'">
                            <div>
                                <span style="margin-left:2px;">
                                    <b>
                                        Mótivo:
                                    </b>
                                </span>
                                <t t-if="not o.refund_invoice_id">
                                    <span>Devolución</span>
                                </t>
                                <t t-else="">
                                    <span t-field="o.name" />
                                </t>
                            </div>
                        </t>
                        <span style="margin-left:2px;">
                            <b>
                                Observaciones:
                            </b>
                        </span>
                        <span t-field="o.narration" />
                    </div>
                    <!-- fin observaciones -->
                    <!-- Fin datos documento -->
                    <!-- Datos del cliente -->
                    <!-- Datos del documento -->
                    <!-- Descuentos -->
                    <t t-set="total_discount1" t-value="0" />
                    <t t-set="total_discount3" t-value="0" />
                    <t t-set="delivery" t-value="0" />
                    <t t-foreach="o.invoice_line_ids" t-as="line">
                        <t t-set="line_discount1" t-value="0" />
                        <t t-set="unit_price" t-value="line.price_unit" />
                        <t t-if="line.product_id">
                            <t t-if="line.discount != 0">
                                <t t-set="line_discount1" t-value="unit_price * line.discount / 100 * line.quantity" />
                                <t t-set="unit_price" t-value="unit_price - (unit_price * line.discount / 100)" />
                            </t>
                            <t t-if="line_discount1 != 0">
                                <t t-set="total_discount1" t-value="total_discount1 + line_discount1" />
                            </t>
                        </t>
                    </t>
                    <!-- fin descuentos -->
                    <!-- Fin datos documento -->
                    <t t-set="display_discount" t-value="any([l.discount for l in o.invoice_line_ids])" />
                    <!-- lineas -->
                    <table class="table" style="clear:both;width:100%;border-bottom:2px solid black;">
                        <thead>
                            <tr style="border-top:4px solid black;">
                                <th style="padding:0px;margin:0px;font-size:0.7em;border-bottom:2px solid black;">
                                    <div style="clear:both;color:black;">
                                        <div style="width:10%;display:block;float:left;">
                                            <span>
                                                <b>
                                                    Código
                                                </b>
                                            </span>
                                        </div>
                                        <div style="width:38%;display:block;float:left;">
                                            <span>
                                                <b>
                                                    Descripción
                                                </b>
                                            </span>
                                        </div>
                                        <div style="width:7%;display:block;float:left;text-align:right;">
                                            <span>
                                                <b>
                                                    IVA%
                                                </b>
                                            </span>
                                        </div>
                                        <div style="width:10%;display:block;float:left;text-align:right;">
                                            <span>
                                                <b>
                                                    Unds
                                                </b>
                                            </span>
                                        </div>
                                        <div style="width:9%;display:block;float:left;text-align:right;">
                                            <span>
                                                <b>
                                                    Precio/U
                                                </b>
                                            </span>
                                        </div>
                                        <div style="width:8%;display:block;float:left;text-align:right;">
                                            <t t-if="total_discount1 != 0">
                                                <span>
                                                    <b>
                                                        Desc.%
                                                    </b>
                                                </span>
                                            </t>
                                            <t t-else="">
                                                <span style="color:white;">
                                                    <b>
                                                        Desc.%
                                                    </b>
                                                </span>
                                            </t>
                                        </div>
                                        <div style="width:8%;display:block;float:left;text-align:right;">
                                            <span>
                                                <b>
                                                    Neto
                                                </b>
                                            </span>
                                        </div>
                                        <div style="width:10%;display:block;float:left;text-align:right;">
                                            <span>
                                                <b>
                                                    Importe
                                                </b>
                                            </span>
                                        </div>
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <!-- marca de agua -->
                        <div class="watermark" style="position:absolute;opacity:0.25;font-size:3em;width:100%;text-align:center;z-index:1000;-webkit-transform: rotate(-37deg);margin-top:450px;">
                            <t t-if="isInvoice == 'out_invoice'">
                                <p>
                                    *FACTURA*
                                </p>
                            </t>
                            <t t-if="isInvoice == 'out_refund'">
                                <p>
                                    *NOTA DE CREDITO*
                                </p>
                            </t>
                        </div>
                        <!-- fin marca de agua -->
                        <!-- Variables -->
                        <t t-set="current_subtotal" t-value="0" />
                        <t t-set="current_discount" t-value="0" />
                        <t t-set="current_bruto" t-value="0" />
                        <t t-set="lineas" t-value="0" />
                        <t t-set="portes" t-value="0" />
                        <t t-set="importeIva21" t-value="0" />
                        <t t-set="importeRec52" t-value="0" />
                        <t t-set="importeIva21Total" t-value="0" />
                        <t t-set="importeRec52Total" t-value="0" />
                        <t t-set="importeIva10" t-value="0" />
                        <t t-set="importeRec14" t-value="0" />
                        <t t-set="importeIva10Total" t-value="0" />
                        <t t-set="importeRec14Total" t-value="0" />
                        <t t-set="importeIva4" t-value="0" />
                        <t t-set="importeRec05" t-value="0" />
                        <t t-set="importeIva4Total" t-value="0" />
                        <t t-set="importeRec05Total" t-value="0" />
                        <t t-set="weight" t-value="0" />
                        <!-- Fin variables -->
                        <tbody class="sale_tbody">
                            <!--  Variables  -->
                            <t t-set="subtotal" t-value="0.0"/>
                            <t t-set="lines_grouped" t-value="o.lines_grouped_by_picking()"/>
                            <!--  Fin Variables  -->
                            <t t-foreach="lines_grouped" t-as="lines_group">
                                <!--  Variables FOREACH  -->
                                <t t-set="l" t-value="lines_group['line']"/>
                                <t t-set="line" t-value="lines_group['line']"/>
                                <t t-set="picking" t-value="lines_group['picking']"/>
                                <t t-set="lines_grouped" t-value="o.lines_grouped_by_picking()"/>
                                <t t-set="next_picking" t-value="[lines_grouped[i + 1]['picking'] for i, x in enumerate(lines_grouped) if x == lines_group and i &lt; len(lines_grouped) - 1] or [False]"/>
                                <!--  Fin Variables FOREACH  -->
                                <!--  Linea del Picking  -->
                                 <tr>
                                    <td style="padding:0px;margin:0px;border:none;">
                                        <t t-if="picking != last_picking">
                                            <t t-if="picking">
                                                <div style="color: black!important; padding: 0px; margin: 0px; width:100%; margin-left:5px; font-size:0.8em; ">
                                                    <b>
                                                        <span>Albarán:</span>
                                                        <span t-field="picking.name"/>
                                                        <span> - </span>
                                                        <span t-field="picking.date_done" t-options="{'widget': 'date'}"/>
                                                        <t t-if="picking.note">
                                                            <span> - </span>
                                                            <span t-field="picking.note"/>
                                                        </t>
                                                    </b>
                                                </div>
                                            </t>
                                            <t t-else="">
                                            </t>
                                        </t>
                                        <!--  Fin linea del Picking  -->
                                        <!-- calculo peso -->
                                        <t t-if="line.product_id.weight">
                                            <t t-set="weight" t-value="weight + line.product_id.weight * line.quantity" />
                                        </t>
                                        <!-- fin calculo peso -->
                                        <t t-set="productName" t-value="line.product_id.name" />
                                        <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded" />
                                        <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included" />
                                        <!-- calculos del descuento -->
                                        <t t-set="current_discount" t-value="current_discount + (line.quantity * line.price_unit) - line.price_subtotal" groups="sale.group_discount_per_so_line" />
                                        <!-- Fin calculos del descuento -->
                                        <!-- Calculos del bruto -->
                                        <t t-set="current_bruto" t-value="current_bruto + (line.quantity * line.price_unit)" groups="account.group_show_line_subtotals_tax_excluded" />
                                        <!-- Fin calculos del bruto -->
                                        <!-- fin si es entrega -->
                                        <!-- Si es nota -->
                                        <t t-if="not line.product_id">
                                            <div class="text-left" style="font-size:0.7em;">
                                                <span style="margin-left:15px;">
                                                    NOTA:
                                                </span>
                                                <span t-field="l.name" />
                                            </div>
                                        </t>
                                        <!-- Fin si es nota -->
                                        <t t-if="l.product_id">
                                           <!-- <t t-if="picking != False">-->
                                                <!-- verificar que no sea portes = 0€ -->
                                                <t t-set="mostrar" t-value="True" />
                                                <t t-if="l.price_unit &lt; 0.01">
                                                    <t t-if="l.product_id.type == 'service'">
                                                        <t t-set="mostrar" t-value="False" />
                                                    </t>
                                                </t>
                                                <!-- verificar que no sea portes = 0€ -->
                                                <t t-if="mostrar == True">

                                                    <div style="font-size:0.7em;clear:both;">
                                                        <!-- codigo -->
                                                        <div style="width:10%;display:block;float:left;">
                                                            <t t-if="l.product_id.default_code">
                                                                <span t-field="l.product_id.default_code" />
                                                            </t>
                                                            <t t-else="">
                                                                <span style="color:white;">
                                                                    abc
                                                                </span>
                                                            </t>
                                                        </div>
                                                        <!-- Fin codigo -->
                                                        <!-- Descripcion -->
                                                        <div style="width:38%;display:block;float:left;">
                                                            <t t-if="line.name">
                                                                <t t-set="productName" t-value="l.name" />
                                                                <t t-set="name_num" t-value="productName.find(']') + 1 " />
                                                                <t t-set="name" t-value="productName[name_num:]" />
                                                                <span t-esc="name" />
                                                            </t>
                                                            <t t-else="">
                                                                <span style="color:white;">
                                                                    abc
                                                                </span>
                                                            </t>
                                                        </div>
                                                        <!-- Fin descripcion -->
                                                        <!-- % de IVA -->
                                                        <div style="width:7%;display:block;float:left;text-align:right;">
                                                            <t t-if="o.sale_type_id.name == 'Serie C'">
                                                                <span style="color:white;">
                                                                    abc
                                                                </span>
                                                            </t>
                                                            <t t-else="">
                                                                <t t-set="IVALin" t-value="0" />
                                                                <t t-foreach="l.tax_ids" t-as="tax">
                                                                    <t t-set="tax_name" t-value="tax.name" />
                                                                    <t t-set="isIVA" t-value="tax_name.find('IVA')" />
                                                                    <t t-if="isIVA &gt; -1">
                                                                        <span t-esc="'%.2f'%tax.amount" />
                                                                    </t>
                                                                </t>
                                                            </t>
                                                            <t t-if="not l.tax_ids">
                                                                <span style="color:white;">
                                                                    abc
                                                                </span>
                                                            </t>
                                                        </div>
                                                        <!-- Fin % de IVA -->
                                                        <!-- Cantidad entregada -->
                                                        <div style="width:10%;display:block;float:left;text-align:right">
                                                            <span t-esc="'%.2f'%line.quantity" />
                                                        </div>
                                                        <!-- Fin cantidad entregada -->
                                                        <!-- Precio / U -->
                                                        <div style="width:9%;display:block;float:left;text-align:right;">
                                                            <span t-field="l.price_unit" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}" />
                                                        </div>
                                                        <!-- Fin precio / u -->
                                                        <!-- Descuento -->
                                                        <div t-if="l.discount != 0.00" style="width:8%;display:block;float:left;text-align:right;">
                                                            <t t-if="l.discount != 0.00">
                                                                <span t-field="l.discount" />
                                                            </t>
                                                            <t t-else="">
                                                                <span style="color:white;">
                                                                    abc
                                                                </span>
                                                            </t>
                                                        </div>
                                                        <div t-else="" style="width:8%;display:block;float:left;text-align:right;">
                                                            <span style="color:white;">
                                                                abc
                                                            </span>
                                                        </div>
                                                        <!-- Fin descuento -->
                                                        <!-- Precio Neto / u -->
                                                        <div style="width:8%;display:block;float:left;text-align:right;">
                                                            <t t-set="neto_linea" t-value="l.price_unit" />
                                                            <t t-if="l.discount != 0.00">
                                                                <t t-set="neto_linea" t-value="neto_linea - (neto_linea * l.discount /100)" />
                                                            </t>
                                                            <span t-esc="neto_linea" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}" />
                                                        </div>
                                                        <!-- Fin precio neto / u -->
                                                        <!-- Precio total linea -->
                                                        <div style="width:10%;display:block;float:left;text-align:right;">
                                                            <t t-set="total_linea" t-value="neto_linea * l.quantity" />
                                                            <t t-if="lines_group['quantity'] != l.quantity" id="picking_subtotal" groups="!account.group_show_line_subtotals_tax_included">
                                                                <!--  Compute subtotal for that picking with discounts  -->
                                                                <t t-set="line_picking_subtotal" t-value="l.quantity and lines_group['quantity'] * (l.price_subtotal / l.quantity) or 0.0"/>
                                                                <t t-set="subtotal" t-value="(subtotal or 0.0) + total_linea"/>
                                                                <span t-esc="total_linea" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                                            </t>
                                                            <t t-else="">
                                                                <t t-set="subtotal" t-value="(subtotal or 0.0) + l.price_subtotal"/>
                                                                <span class="text-nowrap" t-field="l.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                                                <span class="text-nowrap" t-field="l.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                                            </t>
                                                        </div>
                                                        <!-- Lista de materiales -->
                                                        <t t-if="l.product_id.bom_count">
                                                            <t t-if="l.product_id.product_tmpl_id.bom_ids.to_print == True">
                                                                <t t-foreach="l.product_id.product_tmpl_id.bom_ids.bom_line_ids" t-as="bom_list">
                                                                    <div style="width:10%;margin-left:4%;float:left;clear:both;">
                                                                            <t t-if="not bom_list.product_id.default_code">
                                                                                <i>
                                                                                    <span style="color:white">aaa</span>
                                                                                </i>
                                                                            </t>
                                                                            <t t-else="">
                                                                                <i>
                                                                                    <span t-esc="bom_list.product_id.default_code" />
                                                                                </i>
                                                                            </t>
                                                                    </div>
                                                                    <div style="width:31.45%;float:left;">
                                                                        <i>
                                                                            <span t-esc="bom_list.product_id.name" />
                                                                        </i>
                                                                    </div>
                                                                    <div style="width:19.5%;float:left;text-align:right;">
                                                                        <i>
                                                                            <t t-set="kit_quantity" t-value="bom_list.product_qty*line.quantity"/>
                                                                            <span t-esc="'%.2f'%kit_quantity" />
                                                                        </i>
                                                                    </div>
                                                                </t>
                                                            </t>
                                                        </t>
                                                        <!-- Fin Lista de materiales -->
                                                        <t t-if="o.sale_type_id.name != 'Serie C'">
                                                            <t t-foreach="l.tax_ids" t-as="tax">
                                                                <t t-set="tax_name" t-value="tax.name" />
                                                                <t t-set="isIVA" t-value="tax_name.find('IVA')" />
                                                            </t>
                                                        </t>
                                                        <!-- Fin precio total de linea -->
                                                    </div>
                                                </t>
                                           <!-- </t>-->
                                        </t>
                                         <!-- Subtotal  -->
                                        <t t-if="picking != next_picking[0]">
                                              <t t-if="picking != False">
                                                <div class="text-right" style="width:100%;font-size:0.7em;margin-right:1%;clear:both;text-align:right;">
                                                    <b>Subtotal: </b>
                                                    <b style="margin-right:0.5%" t-esc="subtotal" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                                </div>
                                                <t t-set="subtotal" t-value="0.0"/>
                                              </t>
                                        </t>
                                    <!-- Fin subtotal  -->
                                    </td>
                                </tr>
                                <t t-set="last_picking" t-value="picking"/>
                            </t>
                        </tbody>
                    </table>
                    <!-- fin lineas -->
                    <!-- totales y calculos -->
                    <t t-set="importeIva" t-value="0" />
                    <t t-set="importeRecargo" t-value="0" />
                    <t t-foreach="o.amount_by_group" t-as="amount_by_group">
                        <t t-set="isIVA" t-value="amount_by_group[0].find('IVA')" />
                        <t t-if="isIVA == 0">
                            <t t-set="importeIva" t-value="importeIva + amount_by_group[1]" />
                        </t>
                        <t t-else="">
                            <t t-set="importeRecargo" t-value="importeRecargo + amount_by_group[1]" />
                        </t>
                    </t>
                    <!-- desgloses IVA y RECARAGO  serie C -->
                    <t t-if="o.sale_type_id.name == 'Serie C'">
                        <div style="width:43%;float:right;font-size:0.7em;clear:both;">
                            <table style="border-bottom:4px solid black;">
                                <tr>
                                    <td style="solid; black; padding: 0px; margin: 0px; width:13%; !important;">
                                        <!-- base imponible sin descuentos -->
                                        <t t-if="o.amount_untaxed_before_global_discounts != 0">
                                            <div style="width:40%;float:left;">
                                                <span>
                                                    Bruto
                                                </span>
                                            </div>
                                            <div style="width:60%;float:left;text-align:right;">
                                                <span t-esc="o.amount_untaxed_before_global_discounts" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}" />
                                            </div>
                                            <!-- Fin base imponible sin descuentos -->
                                        </t>
                                        <t t-else="">
                                            <!-- Base imponible -->
                                        </t>
                                        <!-- Fin base imponible -->
                                        <!-- Descuentos Globales -->
                                        <t t-set="amount_untaxed_before_global_discounts" t-value="o.amount_untaxed_before_global_discounts" />
                                        <t t-foreach="o.global_discount_ids" t-as="discount">
                                            <div t-if="o.amount_global_discount != 0" style="width:40%;float:left;clear:both;">
                                                <span t-esc="discount.name" />
                                                <span t-esc="discount.discount" />
                                                <span>
                                                    %
                                                </span>
                                            </div>
                                            <div t-if="o.amount_global_discount != 0" style="width:60%;float:left;text-align:right;">
                                                <t t-set="global_discount_line" t-value="(amount_untaxed_before_global_discounts * discount.discount / 100)" />
                                                <t t-set="amount_untaxed_before_global_discounts" t-value="amount_untaxed_before_global_discounts - global_discount_line" />
                                                <t t-set="discount_global" t-value="global_discount_line * -1" />
                                                <span t-esc="discount_global" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}">
                                                </span>
                                            </div>
                                        </t>
                                        <!-- Descuentos Globales -->
                                        <!-- Fin Descuentos Globales -->
                                        <!-- Base imponible -->
                                        <div style="width:40%;float:left;">
                                            <span>
                                                Base imponible
                                            </span>
                                        </div>
                                        <div style="width:60%;float:left;text-align:right;">
                                            <span t-esc="o.amount_untaxed" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}" />
                                        </div>
                                        <!-- Fin base imponible -->
                                        <!-- Total -->
                                        <div style="width:40%;float:left;clear:both;">
                                            <b>
                                                <span>
                                                    Total
                                                </span>
                                            </b>
                                        </div>
                                        <div style="width:60%;float:left;text-align:right;">
                                            <b>
                                                <span t-esc="o.amount_total" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}" />
                                            </b>
                                        </div>
                                        <!-- Fin Desglose -->
                                        <div style="clear:both;margin-top:5px;">
                                            <t t-set="noIva" t-value="1" />
                                            <!-- <p>*Exenta de IVA, según artículo 20, Ley 37/1992 de IVA.</p> -->
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </t>
                    <!-- Fin desgloses IVA y RECARAGO serie C -->
                    <!-- desgloses IVA y RECARAGO -->
                    <t t-if="o.sale_type_id.name != 'Serie C'">
                        <!-- Desglose -->
                        <div style="width:40%;margin-left:8%;float:right;font-size:0.7em;clear:both;margin-right:0.65%;">
                            <table style="border-bottom:4px solid black;">
                                <tr>
                                    <td style="solid; black; padding: 0px; margin: 0px; width:13%; !important;">
                                        <!-- Base imponible sin descuentos -->
                                        <t t-if="o.amount_global_discount != 0.00">
                                            <div style="width:50%;float:left;">
                                                <span>
                                                    Bruto
                                                </span>
                                            </div>
                                            <div style="width:50%;float:left;text-align:right;">
                                                <span t-esc="o.amount_untaxed_before_global_discounts" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}" />
                                            </div>
                                            <!-- Fin base imponible sin descuentos -->
                                        </t>
                                        <t t-else="">
                                            <!-- Base imponible -->
                                        </t>
                                        <!-- Fin base imponible -->
                                        <!-- Descuentos Globales -->
                                        <t t-set="amount_untaxed_before_global_discounts" t-value="o.amount_untaxed_before_global_discounts" />
                                        <t t-foreach="o.global_discount_ids" t-as="discount">
                                            <div t-if="o.amount_global_discount != 0" style="width:50%;float:left;clear:both;">
                                                <span t-esc="discount.name" />
                                                <span t-esc="discount.discount" />
                                                <span>
                                                    %
                                                </span>
                                            </div>
                                            <div t-if="o.amount_global_discount != 0" style="width:50%;float:left;text-align:right;">
                                                <t t-set="global_discount_line" t-value="(amount_untaxed_before_global_discounts * discount.discount / 100)" />
                                                <t t-set="amount_untaxed_before_global_discounts" t-value="amount_untaxed_before_global_discounts - global_discount_line" />
                                                <t t-set="discount_global" t-value="global_discount_line * -1" />
                                                <span t-esc="discount_global" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}">
                                                </span>
                                            </div>
                                        </t>
                                        <!-- Descuentos Globales -->
                                        <!-- Fin Descuentos Globales -->
                                        <!-- Base imponible -->
                                        <div style="width:50%;float:left;">
                                            <span>
                                                Base imponible
                                            </span>
                                        </div>
                                        <div style="width:50%;float:left;text-align:right;">
                                            <span t-esc="o.amount_untaxed" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}" />
                                        </div>
                                        <!-- Fin base imponible -->
                                        <!-- desglose de Impuestos -->
                                        <div style="clear:both;">
                                            <t t-foreach="o.amount_by_group" t-as="amount_by_group">
                                                <div style="">
                                                    <t t-if="amount_by_group[3] == 1 and doc.amount_untaxed == amount_by_group[2]">
                                                        <t t-if="amount_by_group[2] &gt; 0">
                                                            <div>
                                                                <span t-esc="amount_by_group[0]" />
                                                                <span>
                                                                    en
                                                                </span>
                                                                <t t-esc="amount_by_group[2]" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}" />
                                                                <span t-esc="amount_by_group[1]" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}" />
                                                            </div>
                                                        </t>
                                                    </t>
                                                    <t t-else="">
                                                        <t t-if="amount_by_group[2] &gt; 0">
                                                            <div style="width:60%;float:left;">
                                                                <span t-esc="amount_by_group[0]" />
                                                                <span>
                                                                    en
                                                                </span>
                                                                <span t-esc="amount_by_group[2]" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}" />
                                                            </div>
                                                            <div style="width:40%;float:left;text-align:right;">
                                                                <span t-esc="amount_by_group[1]" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}" />
                                                            </div>
                                                        </t>
                                                    </t>
                                                </div>
                                            </t>
                                        </div>
                                        <!-- Fin desglose impuestos -->
                                        <!-- Total -->
                                        <div style="width:50%;float:left;">
                                            <b>
                                                <span>
                                                    Total
                                                </span>
                                            </b>
                                        </div>
                                        <div style="width:50%;float:left;text-align:right;">
                                            <b>
                                                <span t-esc="o.amount_total" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}" />
                                            </b>
                                        </div>
                                        <!-- Fin Desglose -->
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </t>
                    <!-- Metodo de pago -->
                    <t t-if="o.invoice_payment_term_id">
                        <t t-set="plazos" t-value="o.invoice_payment_term_id.name" />
                    </t>
                    <!-- Fin metodo de pago -->
                    <!-- Leyenda Factura -->
                    <p t-if="o.fiscal_position_id.note" name="note">
                        <span t-field="o.fiscal_position_id.note" />
                    </p>
                    <div id="qrcode" t-if="(o.partner_id.country_id.code in ['BE', 'AT', 'DE', 'FI', 'NL']) and (o.company_id.qr_code) and (o.currency_id.name == 'EUR') and (o.partner_bank_id.acc_number != False)">
                        <p t-if="(o.partner_bank_id.qr_code_valid)">
                            <strong class="text-center">
                                Scan me with your banking app.
                            </strong>
                            <br />
                            <br />
                            <img class="border border-dark rounded" t-att-src="o.partner_bank_id.build_qr_code_url(o.residual,(o.reference) if (o.reference) else o.name)" />
                        </p>
                        <p t-if="(o.partner_bank_id.qr_code_valid == False)">
                            <strong class="text-center">
                                The SEPA QR Code informations are not set correctly.
                            </strong>
                            <br />
                        </p>
                    </div>
                    <!-- Inversion de sujeto pasivo -->
                    <t t-if="o.sale_type_id.name == 'Serie C'">
                        <!-- Porte y precio -->
                        <t t-set="PortPrice" t-value="0" />
                        <!-- Fin Porte y precios -->
                        <t t-foreach="o.invoice_line_ids" t-as="line">
                            <t t-if="line.product_id.default_code == 'ENT0'">
                                <t t-set="PortPrice" t-value="line.price_unit" />
                            </t>
                        </t>
                    </t>
                    <!-- Fin inversión del sujeto pasivo -->
                    </div>
                </t>
            </t>
		</template>
	</data>
</odoo>
